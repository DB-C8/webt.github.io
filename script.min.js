const preload=()=>{const e=new THREE.LoadingManager;let t=null;e.onLoad=(()=>{new Environment(t,s)});const i=new THREE.FontLoader(e);i.load("https://res.cloudinary.com/dydre7amr/raw/upload/v1612950355/font_zsd4dr.json",e=>{t=e});const s=new THREE.TextureLoader(e).load("https://res.cloudinary.com/dfvtkoboz/image/upload/v1605013866/particle_a64uzf.png")};"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?preload():document.addEventListener("DOMContentLoaded",preload);class Environment{constructor(e,t){this.font=e,this.particle=t,this.container=document.querySelector("#magic"),this.scene=new THREE.Scene,this.createCamera(),this.createRenderer(),this.setup(),this.bindEvents()}bindEvents(){window.addEventListener("resize",this.debounce(this.onWindowResize.bind(this),200))}setup(){this.createParticles=new CreateParticles(this.scene,this.font,this.particle,this.camera,this.renderer)}render(){this.createParticles.render(),this.renderer.render(this.scene,this.camera)}createCamera(){this.camera=new THREE.PerspectiveCamera(65,this.container.clientWidth/this.container.clientHeight,1,1e4),this.camera.position.set(0,0,100)}createRenderer(){this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.outputEncoding=THREE.sRGBEncoding,this.container.appendChild(this.renderer.domElement),this.renderer.setAnimationLoop(()=>{this.render()})}onWindowResize(){this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.createParticles.adjustTextSize()}debounce(e,t){let i;return function(...s){clearTimeout(i),i=setTimeout(()=>e.apply(this,s),t)}}}class CreateParticles{constructor(e,t,i,s,n){this.scene=e,this.font=t,this.particleImg=i,this.camera=s,this.renderer=n,this.raycaster=new THREE.Raycaster,this.mouse=new THREE.Vector2(-200,200),this.colorChange=new THREE.Color,this.buttom=!1,this.data={text:"WEB610",amount:1e3,particleSize:1,particleColor:16777215,textSize:this.getAutoTextSize(),area:250,ease:.05},this.setup(),this.bindEvents()}setup(){const e=new THREE.PlaneGeometry(this.visibleWidthAtZDepth(100,this.camera),this.visibleHeightAtZDepth(100,this.camera)),t=new THREE.MeshBasicMaterial({color:65280,transparent:!0});this.planeArea=new THREE.Mesh(e,t),this.planeArea.visible=!1,this.createText()}bindEvents(){document.addEventListener("mousedown",this.onMouseDown.bind(this)),document.addEventListener("mousemove",this.onMouseMove.bind(this)),document.addEventListener("mouseup",this.onMouseUp.bind(this))}getAutoTextSize(){const e=window.innerWidth,t=window.innerHeight,i=.05*Math.min(e,t);return i}adjustTextSize(){let e=this.getAutoTextSize();this.data.textSize=e;let t=!1;for(;!t;){this.scene.remove(this.particles),this.createText();const i=this.getTextBoundingBox(),s=this.renderer.domElement.clientWidth,n=this.renderer.domElement.clientHeight;i.width>s||i.height>n?(e*=.9,this.data.textSize=e):t=!0}}getTextBoundingBox(){const e=(new THREE.Box3).setFromObject(this.particles),t=new THREE.Vector3;return e.getSize(t),t}createText(){const e=[];this.data.textSize=this.getAutoTextSize();const t=this.font.generateShapes(this.data.text,this.data.textSize),i=new THREE.ShapeGeometry(t);i.computeBoundingBox();const s=-.5*(i.boundingBox.max.x-i.boundingBox.min.x),n=(i.boundingBox.max.y-i.boundingBox.min.y)/2.85;i.center();const a=[];t.forEach(e=>{e.holes&&e.holes.length>0&&e.holes.forEach(e=>{a.push(e)})}),t.push(...a);const o=[],r=[];t.forEach(t=>{const i="Path"===t.type?this.data.amount/2:this.data.amount,s=t.getSpacedPoints(i);s.forEach(t=>{const i=new THREE.Vector3(t.x,t.y,0);e.push(i),o.push(this.colorChange.r,this.colorChange.g,this.colorChange.b),r.push(1)})});const h=(new THREE.BufferGeometry).setFromPoints(e);h.translate(s,n,0),h.setAttribute("customColor",new THREE.Float32BufferAttribute(o,3)),h.setAttribute("size",new THREE.Float32BufferAttribute(r,1));const c=new THREE.ShaderMaterial({uniforms:{color:{value:new THREE.Color(16777215)},pointTexture:{value:this.particleImg}},vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0});this.particles=new THREE.Points(h,c),this.scene.add(this.particles),this.geometryCopy=new THREE.BufferGeometry,this.geometryCopy.copy(this.particles.geometry)}onMouseDown(e){this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1;const t=new THREE.Vector3(this.mouse.x,this.mouse.y,.5);t.unproject(this.camera);const i=t.sub(this.camera.position).normalize(),s=-this.camera.position.z/i.z;this.currenPosition=this.camera.position.clone().add(i.multiplyScalar(s)),this.buttom=!0,this.data.ease=.01}onMouseUp(){this.buttom=!1,this.data.ease=.05}onMouseMove(e){this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1}render(){const e=.001*performance.now()%12/12,t=(1+Math.sin(2*e*Math.PI))/6;this.raycaster.setFromCamera(this.mouse,this.camera);const i=this.raycaster.intersectObject(this.planeArea);if(i.length>0){const e=this.particles.geometry.attributes.position,s=this.geometryCopy.attributes.position,n=this.particles.geometry.attributes.customColor,a=this.particles.geometry.attributes.size,o=i[0].point.x,r=i[0].point.y;i[0].point.z;for(let i=0,h=e.count;i<h;i++){const h=s.getX(i),c=s.getY(i),d=s.getZ(i);let l=e.getX(i),u=e.getY(i),m=e.getZ(i);this.colorChange.setHSL(.5,1,1),n.setXYZ(i,this.colorChange.r,this.colorChange.g,this.colorChange.b),n.needsUpdate=!0,a.array[i]=this.data.particleSize,a.needsUpdate=!0;let p=o-l,g=r-u;const E=this.distance(o,r,l,u),w=p*p+g*g,b=-this.data.area/w;if(this.buttom){const e=Math.atan2(g,p);l-=b*Math.cos(e),u-=b*Math.sin(e),this.colorChange.setHSL(.5+t,1,.5),n.setXYZ(i,this.colorChange.r,this.colorChange.g,this.colorChange.b),n.needsUpdate=!0,(l>h+70||l<h-70||u>c+70||u<c-70)&&(this.colorChange.setHSL(.15,1,.5),n.setXYZ(i,this.colorChange.r,this.colorChange.g,this.colorChange.b),n.needsUpdate=!0)}else if(E<this.data.area){if(i%5==0){const e=Math.atan2(g,p);l-=.03*Math.cos(e),u-=.03*Math.sin(e),this.colorChange.setHSL(.15,1,.5),n.setXYZ(i,this.colorChange.r,this.colorChange.g,this.colorChange.b),n.needsUpdate=!0,a.array[i]=this.data.particleSize/1.2,a.needsUpdate=!0}else{const t=Math.atan2(g,p);l+=b*Math.cos(t),u+=b*Math.sin(t),e.setXYZ(i,l,u,m),e.needsUpdate=!0,a.array[i]=1.3*this.data.particleSize,a.needsUpdate=!0}(l>h+10||l<h-10||u>c+10||u<c-10)&&(this.colorChange.setHSL(.15,1,.5),n.setXYZ(i,this.colorChange.r,this.colorChange.g,this.colorChange.b),n.needsUpdate=!0,a.array[i]=this.data.particleSize/1.8,a.needsUpdate=!0)}l+=(h-l)*this.data.ease,u+=(c-u)*this.data.ease,m+=(d-m)*this.data.ease,e.setXYZ(i,l,u,m),e.needsUpdate=!0}}}visibleHeightAtZDepth(e,t){const i=t.position.z;e<i?e-=i:e+=i;const s=t.fov*Math.PI/180;return 2*Math.tan(s/2)*Math.abs(e)}visibleWidthAtZDepth(e,t){const i=this.visibleHeightAtZDepth(e,t);return i*t.aspect}distance(e,t,i,s){return Math.sqrt((e-i)**2+(t-s)**2)}}